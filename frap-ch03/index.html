<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tinkerrobot.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本书中所有完全形式化的证明都是在配套的Coq代码中进行的。因此，在我们进一步讨论更多有关程序语义及其证明的内容之前，培养一些基本的Coq能力是很重要的。为此，本书配套了若干带有详细注释的示例代码文件。本书不会在“附录A”以外的章节中详细描述Coq形式化证明的细节。然而，在这些Coq代码中所展示的一种可能性值得我们注意、尽管我们尚未将它与编程语言的形式化语法联系起来，但其本身就是语义学中的一个重要概">
<meta property="og:type" content="blog">
<meta property="og:title" content="【FRAP】第三章：数据抽象">
<meta property="og:url" content="https://tinkerrobot.github.io/frap-ch03/">
<meta property="og:site_name" content="机器人工程站">
<meta property="og:description" content="本书中所有完全形式化的证明都是在配套的Coq代码中进行的。因此，在我们进一步讨论更多有关程序语义及其证明的内容之前，培养一些基本的Coq能力是很重要的。为此，本书配套了若干带有详细注释的示例代码文件。本书不会在“附录A”以外的章节中详细描述Coq形式化证明的细节。然而，在这些Coq代码中所展示的一种可能性值得我们注意、尽管我们尚未将它与编程语言的形式化语法联系起来，但其本身就是语义学中的一个重要概">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-22T17:00:00.000Z">
<meta property="article:modified_time" content="2022-08-26T07:17:26.323Z">
<meta property="article:author" content="TinkerRobot">
<meta property="article:tag" content="FRAP">
<meta property="article:tag" content="形式化验证">
<meta property="article:tag" content="读书笔记">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tinkerrobot.github.io/frap-ch03/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tinkerrobot.github.io/frap-ch03/","path":"frap-ch03/","title":"【FRAP】第三章：数据抽象"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【FRAP】第三章：数据抽象 | 机器人工程站</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">机器人工程站</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">TinkerRobot 的藏宝阁</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E6%8A%BD%E8%B1%A1%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BB%A3%E6%95%B0%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.</span> <span class="nav-text">3.1 抽象数据类型的代数接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%85%B7%E6%9C%89%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%B8%E7%AD%89%E5%85%B3%E7%B3%BB%E7%9A%84%E4%BB%A3%E6%95%B0%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.</span> <span class="nav-text">3.2 具有自定义相等关系的代数接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E8%A1%A8%E7%A4%BA%E5%87%BD%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">3.3 表示函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E5%9B%BA%E5%AE%9A%E6%8A%BD%E8%B1%A1%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.</span> <span class="nav-text">3.4 固定抽象数据类型的参数类型</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="TinkerRobot"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">TinkerRobot</p>
  <div class="site-description" itemprop="description">Programmer / Gamer / Husband</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tinkerrobot" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tinkerrobot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tinker_rb330@outlook.com" title="E-Mail → mailto:tinker_rb330@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/lilinsanity" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;lilinsanity" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/tinkerrobot" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tinkerrobot.github.io/frap-ch03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="TinkerRobot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="机器人工程站">
      <meta itemprop="description" content="Programmer / Gamer / Husband">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【FRAP】第三章：数据抽象 | 机器人工程站">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【FRAP】第三章：数据抽象
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-23 01:00:00" itemprop="dateCreated datePublished" datetime="2022-08-23T01:00:00+08:00">2022-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-26 15:17:26" itemprop="dateModified" datetime="2022-08-26T15:17:26+08:00">2022-08-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/FRAP/" itemprop="url" rel="index"><span itemprop="name">FRAP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本书中所有完全形式化的证明都是在配套的Coq代码中进行的。因此，在我们进一步讨论更多有关程序语义及其证明的内容之前，培养一些基本的Coq能力是很重要的。为此，本书配套了若干带有详细注释的示例代码文件。本书不会在“附录A”以外的章节中详细描述Coq形式化证明的细节。然而，在这些Coq代码中所展示的一种可能性值得我们注意、尽管我们尚未将它与编程语言的形式化语法联系起来，但其本身就是语义学中的一个重要概念，这就是 <em>数据抽象</em>，它是程序结构化中最核心的概念之一。我们首先研究数据结构中 <em>封装</em> 在数学上的含义。</p>
<span id="more"></span>

<h2 id="3-1-抽象数据类型的代数接口"><a href="#3-1-抽象数据类型的代数接口" class="headerlink" title="3.1 抽象数据类型的代数接口"></a>3.1 抽象数据类型的代数接口</h2><p>我们从一个最简单的队列开始。队列是一种可以将数据元素依次入队并将它们按照与入队时相同的顺序依次出队的经典数据结构。也许会让人惊讶的是，要实现一个高效的队列确实是有一定的复杂性的，但是使用队列的所谓 <em>客户端代码</em> 并不需要了解这些实现细节。因此，我们可以隐藏其实现细节，将“队列”表述为一个 <em>抽象数据类型</em>。在诸如Coq一类的纯函数式编程的环境中，我们使用如下的方法将一个数据类型表示成一组类型和操作的集合，这看上去有些类似于Java中的接口。在下面的表达式中，类型 $\mathsf{t}(\alpha)$ 表示数据元素的类型为 $\alpha$ 的队列。</p>
<p>$$<br>\begin{aligned}<br>\mathsf{t}(\alpha) &amp;: \mathsf{Set} \<br>\mathsf{empty} &amp;: \mathsf{t}(\alpha) \<br>\mathsf{enqueue} &amp;: \mathsf{t}(\alpha) \times \alpha \to \mathsf{t}(\alpha) \<br>\mathsf{dequeue} &amp;: \mathsf{t}(\alpha) \rightharpoonup \mathsf{t}(\alpha) \times \alpha<br>\end{aligned}<br>$$</p>
<p>这里有一些需要注意的符号用法：首先，我们通过将 $\mathsf{t}(\alpha)$ 指定为类型 <code>Set</code> 来将其声明为一个类型，这里的 <code>Set</code> 包含了编程中的所有标准类型。对于任意的类型 $\alpha$，均存在空队列(empty)和入队(enqueue)与出队(dequeue)操作。其次，dequeue使用箭头 $\rightharpoonup$ 表示这是一个偏函数：对于空队列而言，出队操作不产生任何结果。对于偏函数 $f: A \rightharpoonup B$，我们使用 $f(x) &#x3D; \cdot$ 表示函数 $f$ 在 $x \in A$ 上没有映射。</p>
<p>在定义抽象数据类型时，通常我们就止步于这一层面了。但如果要进行形式化的正确性证明，就必须为数据类型增加若干 <em>规范</em>(specs)。<em>代数规则</em> 是规范的一种重要形式，即定义一组等式，这些等式中包含数据类型上的操作。对于队列，有以下两个规则：</p>
<p>$$<br>\begin{aligned}<br>\mathsf{dequeue}(\mathsf{empty}) &#x3D; \cdot \<br>\forall q. ; \mathsf{dequeue}(q) &#x3D; \cdot \Rightarrow q &#x3D; \mathsf{empty} \<br>\end{aligned}<br>$$</p>
<p>实际上，上一章使用的推断规则记号能让代数规则更易读，因此上面的式子可重写为</p>
<p>$$<br>\frac{}{\mathsf{dequeue}(\mathsf{empty}) &#x3D; \cdot}<br>\quad<br>\frac{\mathsf{dequeue}(q) &#x3D; \cdot}{q &#x3D; \mathsf{empty}}<br>$$</p>
<p>下面这条规则使用了数学中分段函数的符号，从而完整地描述入队出队操作的行为：</p>
<p>$$<br>\frac{}{\mathsf{dequeue}(\mathsf{enqueue}(q, x)) &#x3D; \begin{cases}<br>    (\mathsf{empty}, x), &amp; \mathsf{dequeue}(q) &#x3D; \cdot \<br>    (\mathsf{enqueue}(q’, x), y), &amp; \mathsf{dequeue}(q) &#x3D; (q’, y)<br>\end{cases}}<br>$$</p>
<p>现在这个队列的功能有几种方式可以实现。首先是两个“显而易见”的方案，其一使用一个列表，从列表首端入队、末端出队。我们使用 $\mathsf{list}(\alpha)$ 表示含有类型为 $\alpha$ 的数据元素的列表，使用 $\ell_1 \bowtie \ell_2$ 表示列表 $\ell_1$ 的 $\ell_2$ 的连接，使用在方括号内以逗号分隔的列表表示一个列表字面量。</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{t(\alpha)} &amp;&#x3D; \mathsf{list}(\alpha) \<br>    \mathsf{empty} &amp;&#x3D; [] \<br>    \mathsf{enqueue}(q, x) &amp;&#x3D; {[x]} \bowtie {q} \<br>    \mathsf{dequeue}([]) &amp;&#x3D; \cdot \<br>    \mathsf{dequeue}({[x]} \bowtie {q}) &amp;&#x3D; ([], x)\textrm{, 若 $\mathsf{dequeue}(q) &#x3D; \cdot$.} \<br>    \mathsf{dequeue}({[x]} \bowtie {q}) &amp;&#x3D; ({[x]} \bowtie {q’}, y)\textrm{, 若 $\mathsf{dequeue}(q) &#x3D; (q’, y)$.}<br>\end{aligned}<br>$$</p>
<p>相对地，另一种实现方式是从列表末端入队、首端出队。</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{t(\alpha)} &amp;&#x3D; \mathsf{list}(\alpha) \<br>    \mathsf{empty} &amp;&#x3D; [] \<br>    \mathsf{enqueue}(q, x) &amp;&#x3D; {q} \bowtie {[x]} \<br>    \mathsf{dequeue}([]) &amp;&#x3D; \cdot \<br>    \mathsf{dequeue}({[x]} \bowtie {q}) &amp;&#x3D; (q, x)<br>\end{aligned}<br>$$</p>
<p>对以上两种实现的代数规则的证明，均可在配套的Coq代码中找到。若假定连接操作需要花费与第一个列表的长度呈线性关系的时间，则这两种实现实际上均需花费平方级别的时间。有一种更为著名和巧妙的实现，能够实现均摊的常数时间复杂度（即对于连续的一系列操作花费线性级别的时间），但首先我们需要扩充我们的代数规则，才能描述这一实现。</p>
<h2 id="3-2-具有自定义相等关系的代数接口"><a href="#3-2-具有自定义相等关系的代数接口" class="headerlink" title="3.2 具有自定义相等关系的代数接口"></a>3.2 具有自定义相等关系的代数接口</h2><p>我们可以为队列的基础接口新增一个数学上的“运算”</p>
<p>$$<br>\begin{aligned}<br>\mathsf{t}(\alpha) &amp;: \mathsf{Set} \<br>\mathsf{empty} &amp;: \mathsf{t}(\alpha) \<br>\mathsf{enqueue} &amp;: \mathsf{t}(\alpha) \times \alpha \to \mathsf{t}(\alpha) \<br>\mathsf{dequeue} &amp;: \mathsf{t}(\alpha) \rightharpoonup \mathsf{t}(\alpha) \times \alpha \<br>\mathsf{\approx} &amp;: \mathcal P(\mathsf{t}(\alpha) \times \mathsf{t}(\alpha))<br>\end{aligned}<br>$$</p>
<p>我们使用“幂集”运算 $\mathcal P$ 表示 $\approx$ 是一个作用于（相同类型的）队列的二元关系运算符。我们的目的是使用 $\approx$ 表示 <em>相等</em> 关系，其形式化定义如下：</p>
<p>$$<br>\frac{}{a \approx a} \mathsf{自反性}<br>\quad \frac{b \approx a}{a \approx b} \mathsf{对称性}<br>\quad \frac{a \approx b \quad b \approx c}{a \approx c} \mathsf{传递性}<br>$$</p>
<p>现在我们就可以使用 $\approx$ 代替等号重写原有的规则。这里我们隐式地扩大了 $\approx$ 的含义以使其能够作用在偏函数 $\mathsf{dequeue}$ 的结果上：不存在的结果 $\cdot$ 总是和自身相同；$(q_1, x_1)$ 和 $(q_2, x_2)$ 相同，当且仅当 $q_1 \approx q_2$ and $x_1 &#x3D; x_2$。</p>
<p>$$<br>\frac{}{\mathsf{dequeue}(\mathsf{empty}) &#x3D; \cdot}<br>\quad \frac{\mathsf{dequeue}(q) &#x3D; \cdot}{q \approx \mathsf{empty}}<br>$$</p>
<p>$$<br>\frac{}{\mathsf{dequeue}(\mathsf{enqueue}(q, x)) \approx<br>\begin{cases}<br>    (\mathsf{empty}, x), &amp; \mathsf{dequeue}(q) &#x3D; \cdot \<br>    (\mathsf{enqueue}(q’, x), y), &amp; \mathsf{dequeue}(q) &#x3D; (q’, y)<br>\end{cases}}<br>$$</p>
<p>我们能够从这样的改写中得到什么回报呢？首先，通过使用 $\approx$ 表示相等性，我们能够对上面两个队列的实现进行合理性检查，即这两个实现均符合队列的规范。更重要的是，现在我们还可以开始研究经典的 <em>双栈队列</em>。下面是它的实现，这里用到了将列表反转的函数 $\mathsf{rev}$ （这一函数具有线性复杂度）。</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{t(\alpha)} &amp;&#x3D; \mathsf{list}(\alpha) \times \mathsf{list}(\alpha) \<br>    \mathsf{empty} &amp;&#x3D; ([], []) \<br>    \mathsf{enqueue}((\ell_1, \ell_2), x) &amp;&#x3D; ({[x]} \bowtie {\ell_1}, \ell_2) \<br>    \mathsf{dequeue}(([], [])) &amp;&#x3D; \cdot \<br>    \mathsf{dequeue}((\ell_1, {[x]} \bowtie {\ell_2})) &amp;&#x3D; ((\ell_1, \ell_2), x) \<br>    \mathsf{dequeue}((\ell_1, [])) &amp;&#x3D; (([], q’_1), x)\textrm{, 且 $\mathsf{rev}(\ell_1) &#x3D; {[x]} \bowtie {q’_1}$.}<br>\end{aligned}<br>$$</p>
<p>这里的技巧在于使用一对列表 $(\ell_1, \ell_2)$ 来表示一个队列。入队时，我们向 $\ell_1$ 的队首加入元素，此时这一操作仅有常数复杂度；出队时，我们从 $\ell_2$ 的队首移除元素，此时也仅有常数复杂度。但是，如果 $\ell_2$ 中的元素被全部移除，就必须 <em>反转</em> $\ell_1$ 并将结果移至 $\ell_2$。</p>
<p>我们可以用下面的相等关系将上述规则形式化。</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{rep}((\ell_1, \ell_2)) &amp;&#x3D; {\ell_1} \bowtie {\mathsf{rev}(\ell_2)} \<br>    q_1 \approx q_2 &amp;&#x3D; \mathsf{rep}(q_1) &#x3D; \mathsf{rep}(q_2)<br>\end{aligned}<br>$$</p>
<p>我们可以证明：这里定义的 $\approx$ 确实是相等关系，同时这里的实现也满足队列的所有规范。因此，客户端代码（及其正确性证明）在使用这一代码时，实际上可以将其视为一个普通的队列，隐藏底层的双栈实现。</p>
<p>我们为什么要大费周章地引入自定义相等关系这一操作呢？考虑下面的两个队列，如何判定它们的相等性？（这里的函数 $\pi_1$ 表示取出一个对组中的第一个元素。）</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{enqueue}(\mathsf{empty}, 2) &amp;\stackrel{?}{&#x3D;} \pi_1(\mathsf{dequeue}(\mathsf{enqueue}(\mathsf{enqueue}(\mathsf{empty}, 1), 2)))<br>\end{aligned}<br>$$</p>
<p>答案是这两个队列并不相等！对双栈队列而言，第一个表达式的结果为 $([2], [])$，而第二个表达式的结果为 $([], [2])$。我们称这种数据结构为 <em>非规范化的</em>，指的是逻辑上相同的值可以对应于多个实际表示。自定义的相等关系允许我们指定哪些实际表示是相等的。</p>
<h2 id="3-3-表示函数"><a href="#3-3-表示函数" class="headerlink" title="3.3 表示函数"></a>3.3 表示函数</h2><p>最后一种定义相等关系的方法基于 <em>表示函数</em>。我们可以要求每个队列的实现包含一个函数，这个函数将队列转换成一个标准、规范化的表示形式。实际运行的程序一般不应当调用这个函数，它的主要作用是帮助我们更好地描述代数规则。或许会令读者惊讶的是，只要符合这一要求的函数存在，就足以表明队列实现的正确性，并且这一方法可以推广到基本上所有其它作为抽象数据类型的数据结构。</p>
<p>修改后的队列的类型签名如下：</p>
<p>$$<br>\begin{aligned}<br>    \mathsf{t}(\alpha) &amp;: \mathsf{Set} \<br>    \mathsf{empty} &amp;: \mathsf{t}(\alpha) \<br>    \mathsf{enqueue} &amp;: \mathsf{t}(\alpha) \times \alpha \to \mathsf{t}(\alpha) \<br>    \mathsf{dequeue} &amp;: \mathsf{t}(\alpha) \rightharpoonup \mathsf{t}(\alpha) \times \alpha \<br>    \mathsf{rep} &amp;: \mathsf{t}(\alpha) \to \mathsf{list}(\alpha)<br>\end{aligned}<br>$$</p>
<p>修改后的公理如下：</p>
<p>$$<br>\frac{}{\mathsf{rep}(\mathsf{empty}) &#x3D; []}<br>\quad \frac{}{\mathsf{rep}(\mathsf{enqueue}(q, x)) &#x3D; {[x]} \bowtie {\mathsf{rep}(q)}}<br>$$</p>
<p>$$<br>\frac{\mathsf{rep}(q) &#x3D; []}{\mathsf{dequeue}(q) &#x3D; \cdot}<br>\quad \frac{\mathsf{rep}(q) &#x3D; {\ell} \bowtie {[x]}}{\exists q’. ; \mathsf{dequeue}(q) &#x3D; (q’, x) \land \mathsf{rep}(q’) &#x3D; \ell}<br>$$</p>
<p>值得注意的是，上述规范也可以视作 <em>为数据类型提供了参考实现</em>，此时 $\mathsf{rep}$ 表示了在任意时刻如何将数据类型转换回参考实现。</p>
<h2 id="3-4-固定抽象数据类型的参数类型"><a href="#3-4-固定抽象数据类型的参数类型" class="headerlink" title="3.4 固定抽象数据类型的参数类型"></a>3.4 固定抽象数据类型的参数类型</h2><p>下面是另一个经典的抽象数据结构：有限集合，其中 $\mathbb B$ 表示布尔类型的集合。</p>
<p>$$<br>\begin{aligned}<br>  \mathsf{t}(\alpha) &amp;: \mathsf{Set} \<br>  \mathsf{empty} &amp;: \mathsf{t}(\alpha) \<br>  \mathsf{add} &amp;: \mathsf{t}(\alpha) \times \alpha \to \mathsf{t}(\alpha) \<br>  \mathsf{member} &amp;: \mathsf{t}(\alpha) \times \alpha \to \mathbb B<br>\end{aligned}<br>$$</p>
<p>下面的几条规则描述了这一数据结构的预期行为，其中 $\top$ 和 $\bot$ 分别表示 $\mathbb B$ 中的 “真（true）”和“假（false）”。</p>
<p>$$<br>\frac{}{\mathsf{member}(\mathsf{empty}, k) &#x3D; \bot}<br>\quad \frac{}{\mathsf{member}(\mathsf{add}(s, k), k) &#x3D; \top}<br>\quad \frac{k_1 \neq k_2}{\mathsf{member}(\mathsf{add}(s, k_1), k_2) &#x3D; \mathsf{member}(s, k_2)}<br>$$</p>
<p>下面这个简单的方法使用无序列表实现了有限集合。</p>
<p>$$<br>\begin{aligned}<br>  \mathsf{t} &amp;&#x3D; \mathsf{list} \<br>  \mathsf{empty} &amp;&#x3D; [] \<br>  \mathsf{add}(s, k) &amp;&#x3D; {[k]} \bowtie {s} \<br>  \mathsf{member}([], k) &amp;&#x3D; \bot \<br>  \mathsf{member}({[k’]} \bowtie {s}, k) &amp;&#x3D; k &#x3D; k’ \lor \mathsf{member}(s, k)<br>\end{aligned}<br>$$</p>
<p>然而，我们可以为特定的元素类型和使用场景构造特定的有限集。例如，假设我们正在处理的是自然数的集合，并且我们知道其中大多数集合包含的是连续的数字。在这种情况下，只需要存储集合中最小和最大的元素就足够了，这样所有的集合操作都只花费常数时间。假设我们现在已经有一个有限集的基本实现，其类型为 $t_0$，包含 $\mathsf{empty}_0$、$\mathsf{add}_0$ 和 $\mathsf{member}_0$ 三个操作。在这个基础上，我们可以用下面的方法实现一个优化版本的有限集，其中 $\mathsf{fromRange} : \mathbb N \times \mathbb N \to \mathsf{t}_0$ 将一个范围转换成一个临时的集合。</p>
<p>$$<br>\begin{aligned}<br>  \mathsf{t} &amp;&#x3D; \mathsf{Empty} \mid \mathsf{Range}(\mathbb N \times \mathbb N) \mid \mathsf{AdHoc}(\mathsf{t}_0) \<br>  \mathsf{empty} &amp;&#x3D; \mathsf{Empty} \<br>  \mathsf{add}(\mathsf{Empty}, k) &amp;&#x3D; \mathsf{Range}(k, k) \<br>  \mathsf{add}(\mathsf{Range}(n_1, n_2), k) &amp;&#x3D; \mathsf{Range}(n_1, n_2)\textrm{, 若 $n_1 \leq k \leq n_2$} \<br>  \mathsf{add}(\mathsf{Range}(n_1, n_2), n_1-1) &amp;&#x3D; \mathsf{Range}(n_1-1, n_2)\textrm{, 若 $n_1 \leq n_2$} \<br>  \mathsf{add}(\mathsf{Range}(n_1, n_2), n_2+1) &amp;&#x3D; \mathsf{Range}(n_1, n_2+1)\textrm{, 若 $n_1 \leq n_2$} \<br>  \mathsf{add}(\mathsf{Range}(n_1, n_2), k) &amp;&#x3D; \mathsf{AdHoc}(\mathsf{add}_0(\mathsf{fromRange}(n_1, n_2), k))\textrm{, 否则} \<br>  \mathsf{add}(\mathsf{AdHoc}(s), k) &amp;&#x3D; \mathsf{AdHoc}(\mathsf{add}_0(s, k)) \<br>  \mathsf{member}(\mathsf{Empty}, k) &amp;&#x3D; \bot \<br>  \mathsf{member}(\mathsf{Range}(n_1, n_2), k) &amp;&#x3D; n_1 \leq k \leq n_2 \<br>  \mathsf{member}(\mathsf{AdHoc}(s), k) &amp;&#x3D; \mathsf{member}_0(s, k)<br>\end{aligned}<br>$$</p>
<p>可以证明，如果底层的临时集合满足有限集的规范，那么上述的实现也满足有限集的规范。对于只需要对连续的数字构建集合的应用场景，这一实现的效率远高于常规的基于列表的实现，将复杂度由二次级别降低至线性级别。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/FRAP/" rel="tag"># FRAP</a>
              <a href="/tags/%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/" rel="tag"># 形式化验证</a>
              <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"># 读书笔记</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/hello-world/" rel="prev" title="Hello World">
                  <i class="fa fa-chevron-left"></i> Hello World
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TinkerRobot</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
